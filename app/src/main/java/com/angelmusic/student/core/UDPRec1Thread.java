package com.angelmusic.student.core;import android.os.Handler;import com.angelmusic.stu.utils.Log;import com.angelmusic.stu.network.u3d.AndroidDispatcher;import com.angelmusic.stu.server.socket.constant.NetParams;import com.angelmusic.student.constant.Constant;import java.net.DatagramPacket;import java.net.DatagramSocket;import java.net.InetSocketAddress;import java.net.SocketAddress;import java.nio.charset.Charset;/** * Created by DELL on 2017/1/16. */public class UDPRec1Thread extends Thread {    private Handler handler;    private DatagramSocket socket = null;    public UDPRec1Thread(Handler handler) {        this.handler = handler;    }    @Override    public void run() {        try {            // 1、创建套接字            socket = new DatagramSocket(Constant.UDP_PORT);            // 2、创建数据报            byte[] data = new byte[1024];            DatagramPacket packet = new DatagramPacket(data, data.length);            // 3、一直监听端口，接收数据包            while (true) {                socket.receive(packet);                String quest_ip = packet.getAddress().toString().substring(1);                Log.e("UDPRec1Thread", quest_ip + "");                Constant.HOST = quest_ip;                try {                    AndroidDispatcher.getInstance().connectTeacher(ActionType.getMsg(),Constant.HOST, Constant.PORT, new MsgReceiver());                }catch (Exception e){                    e.printStackTrace();                }            }        } catch (Exception e) {            e.printStackTrace();            Log.e("UDPRec1Thread", "udp------------error");        }finally {            if(socket!=null) {                socket.close();                socket = null;            }        }    }    public void sendSycMsg(){        new Thread(new Runnable() {            @Override            public void run() {                DatagramSocket socket = null;                try {                    // 1、创建套接字                    socket = new DatagramSocket();                    // 2、创建host的地址包装实例                    SocketAddress socketAddr = new InetSocketAddress(NetParams.UDP_HOST, NetParams.TEACHER_UDP_PORT);                    // 3、创建数据报。包含要发送的数据、与目标主机地址                    byte[] data = "Hi angle".getBytes(Charset.forName("UTF-8"));                    DatagramPacket packet = new DatagramPacket(data, data.length, socketAddr);                    // 4、发送数据                    for(int i=0; i<5; i++) {                        Thread.sleep(10);                        socket.send(packet);                    }                    Log.e("UDPRec1Thread", "udp------------sendSycMsg OK");                } catch (Exception e) {                    e.printStackTrace();                    Log.e("UDPRec1Thread", "udp------------sendSycMsg failed");                } finally {                    if (null != socket) {                        socket.close();                    }                }            }        }).start();    }}